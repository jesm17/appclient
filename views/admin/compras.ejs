<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compras</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css"
    />
    <script
      src="https://kit.fontawesome.com/b214caadfb.js"
      crossorigin="anonymous"
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.13.1/css/jquery.dataTables.css"
    />
    <link rel="stylesheet" href="../../../style/main.css" />
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  </head>
  <body>
    <div class="w-100">
      <div class="d-flex justyfy-content-beteween">
        <div class="w-50">
          <ul class="nav flex-column w-75">
            <li class="nav-item mt-3 ms-1">
              <a class="btn btn-primary w-50" aria-current="page" href="/admin"
                >Administradores <i class="fa-solid fa-user-tie"></i
              ></a>
            </li>
            <li class="nav-item ms-1">
              <a class="btn btn-secondary w-50" href="/admin/clients/"
                >Clientes <i class="bi bi-people-fill"></i
              ></a>
            </li>
            <li class="nav-item ms-1">
              <a class="btn btn-info text-white w-50" href="/productos/admin"
                >Productos <i class="fa-solid fa-store"></i
              ></a>
            </li>
          </ul>
        </div>
      </div>
      <input type="hidden" value="<%= id %>" id="id" class="id" />
      <main class="w-75 m-auto">
        <div class="mb-4">
          <button
            type="button"
            class="btn btn-warning"
            onclick="history.back()"
          >
            <i class="bi bi-arrow-counterclockwise"></i>
          </button>
          <button type="button" class="btn btn-success" id="addBuyButton">Agregar compra</button>
        </div>
        <div>
          <table
            class="table table-hover align-middle border tableMain"
            id="tableMain"
          >
            <thead>
              <tr>
                <th scope="col">Fecha</th>
                <th scope="col">Total Pagado</th>
                <th scope="col">Acciones</th>
              </tr>
            </thead>
            <tbody id="table"></tbody>
          </table>
        </div>
      </main>
    </div>
  </body>
  
</html>
<script
  src="https://code.jquery.com/jquery-3.6.3.js"
  integrity="sha256-nQLuAZGRRcILA+6dMBOvcRh5Pe310sBpanc6+QBmyVM="
  crossorigin="anonymous"
></script>
<script
  type="text/javascript"
  charset="utf8"
  src="https://cdn.datatables.net/1.13.1/js/jquery.dataTables.js"
></script>
<script>
  let id = $('#id').val();
  axios
    .get(`../../client/getBuy-dateils/${id}`)
    .then((response) => {
      const { data } = response;
      const { compras } = data;
      let text = '';
      for (let i = 0; i < data.length; i++) {
        for (let j = 0; j < data[i].compras.length; j++) {
          let date = data[i].compras[j].createdAt;
          let formatDay = new Date(date);
          formatDay = formatDay.toLocaleDateString();
          text =
            text +
            `
    <tr>
      <th scope="row">${formatDay}</th>
      <td>$${data[i].compras[j].totalPagar}</td>
      <td><button type="button" class="btn border border-1 border-danger" value='${data[i].compras[j].id}'><i class="bi bi-file-earmark-pdf-fill"></i></button></td>
    </tr>`;
        }
      }
      let table = document.getElementById('table');
      table.innerHTML = text;

      $(document).ready(function () {
        $('#tableMain').DataTable({
          language: {
            url: '//cdn.datatables.net/plug-ins/1.13.1/i18n/es-ES.json',
          },
        });
      });
    })
    .catch((error) => {
      console.log(error);
    });
</script>
<script src="/../../js/clients/addBuy.js"></script>